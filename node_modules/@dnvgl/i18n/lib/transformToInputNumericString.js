var __makeTemplateObject = (this && this.__makeTemplateObject) || function (cooked, raw) {
    if (Object.defineProperty) { Object.defineProperty(cooked, "raw", { value: raw }); } else { cooked.raw = raw; }
    return cooked;
};
import { getDecimalSeparator } from "./getDecimalSeparator";
import { getMinusSign } from "./getMinusSign";
import { headAndTail } from "./internal/headAndTail";
var nativeMinusSign = "-";
export function transformToInputNumericString(text, options, locale) {
    var _a, _b, _c, _d;
    var decimalSeparator = getDecimalSeparator(locale), isNativeMinusSignIsUsed = text.includes(nativeMinusSign), minusSign = isNativeMinusSignIsUsed ? nativeMinusSign : getMinusSign(locale);
    var textWithValidCharactersOnly = text
        .replace(new RegExp(String.raw(templateObject_1 || (templateObject_1 = __makeTemplateObject(["[^0-9", "", "]"], ["[^0-9", "", "]"])), decimalSeparator, minusSign), 'g'), '')
        .replace(new RegExp(String.raw(templateObject_2 || (templateObject_2 = __makeTemplateObject(["(?!^)", ""], ["(?!^)", ""])), minusSign), 'g'), '');
    var signPart = textWithValidCharactersOnly.charAt(0) === minusSign ? minusSign : '';
    textWithValidCharactersOnly = textWithValidCharactersOnly.replace(minusSign, '');
    var numericParts = textWithValidCharactersOnly.split(decimalSeparator);
    var integerPart = numericParts[0], separatorPart = '', fractionalPart;
    if (numericParts.length > 1) {
        separatorPart = decimalSeparator;
        var _e = headAndTail(numericParts), tail = _e[1];
        var tailString = tail.join('');
        fractionalPart = (options === null || options === void 0 ? void 0 : options.fractionalPart) !== undefined
            ? options.fractionalPart === 0
                ? ''
                : tailString.substring(0, options.fractionalPart)
            : tailString;
    }
    else {
        fractionalPart = (_a = numericParts[1]) !== null && _a !== void 0 ? _a : '';
    }
    if (!integerPart && (fractionalPart || separatorPart)) {
        integerPart = '0';
    }
    if ((options === null || options === void 0 ? void 0 : options.maxAllowedValue) !== undefined || (options === null || options === void 0 ? void 0 : options.minAllowedValue) !== undefined) {
        var parsedNumber = parseFloat("".concat(signPart).concat(integerPart, ".").concat(fractionalPart));
        if (!Number.isNaN(parsedNumber)) {
            var targetValue = (parsedNumber > ((_b = options.maxAllowedValue) !== null && _b !== void 0 ? _b : parsedNumber))
                ? options.maxAllowedValue
                : (parsedNumber < ((_c = options.minAllowedValue) !== null && _c !== void 0 ? _c : parsedNumber))
                    ? options.minAllowedValue
                    : parsedNumber;
            if (parsedNumber !== targetValue) {
                var parts = targetValue.toString().split('.');
                signPart = parts[0].charAt(0) === minusSign ? minusSign : '';
                integerPart = parts[0].replace(minusSign, '');
                fractionalPart = (_d = parts[1]) !== null && _d !== void 0 ? _d : '';
                separatorPart = fractionalPart ? decimalSeparator : '';
            }
        }
    }
    if ((options === null || options === void 0 ? void 0 : options.fractionalPart) !== undefined) {
        fractionalPart = fractionalPart.substring(0, options.fractionalPart);
        if (options.fractionalPart === 0) {
            separatorPart = '';
        }
        else if ((options === null || options === void 0 ? void 0 : options.allowOnlyHalfs) === true && fractionalPart !== '5') {
            if (fractionalPart.length === 1) {
                fractionalPart = '';
            }
            else if (fractionalPart.length > 1 && parseInt(fractionalPart.substring(1, fractionalPart.length)) !== 0) {
                fractionalPart = fractionalPart[0] === '5' ? '5' : '';
            }
        }
        if (options.forceFractionalPart === true && fractionalPart.length !== options.fractionalPart && !(integerPart === '' && fractionalPart === '')) {
            fractionalPart = fractionalPart.padEnd(options.fractionalPart, '0');
            separatorPart = decimalSeparator;
        }
    }
    if ((options === null || options === void 0 ? void 0 : options.negativeAllowed) === false) {
        signPart = '';
    }
    return "".concat(signPart).concat(integerPart).concat(separatorPart).concat(fractionalPart);
}
var templateObject_1, templateObject_2;
